
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/src/reversi/ReversiBoard.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '80923WSrblNDr5l6s/fRBrL', 'ReversiBoard');
// src/reversi/ReversiBoard.ts

Object.defineProperty(exports, "__esModule", { value: true });
exports.ReversiBoard = void 0;
var ReversiPiece_1 = require("./ReversiPiece");
var ReversiConstants_1 = require("./ReversiConstants");
var _a = cc._decorator, ccclass = _a.ccclass, property = _a.property;
var ReversiBoard = /** @class */ (function (_super) {
    __extends(ReversiBoard, _super);
    function ReversiBoard() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.colsSum = 8;
        _this.rowsSum = 8;
        _this.graphics = null; // 用来画棋盘
        _this.graphics2 = null; // 用来画棋子
        _this.tileWidth = 0; // 一个方块的宽度
        _this.startX = 0; // 棋盘左下角
        _this.startY = 0;
        _this.boardWidth = 0; // 棋盘节点宽高
        _this.boardHeight = 0;
        _this.lastPiece = null;
        _this.reversiScene = null;
        return _this;
    }
    ReversiBoard.prototype.init = function (reversiScene) {
        this.reversiScene = reversiScene;
        this.tileWidth = this.node.width / (this.colsSum + 1);
        this.startX = this.tileWidth / 2;
        this.startY = this.tileWidth / 2;
        this.boardWidth = this.tileWidth * this.colsSum;
        this.boardHeight = this.tileWidth * this.rowsSum;
        this.reset();
        this.addListeners();
    };
    ReversiBoard.prototype.reset = function () {
        this.graphics.clear();
        this.graphics2.clear();
        // 画棋盘
        this.graphics.strokeColor = cc.Color.BLACK;
        for (var x = 0; x < this.colsSum + 1; x++) {
            this.graphics.moveTo(this.startX + x * this.tileWidth, this.startY);
            this.graphics.lineTo(this.startX + x * this.tileWidth, this.startY + this.boardHeight);
            this.graphics.stroke();
        }
        for (var y = 0; y < this.rowsSum + 1; y++) {
            this.graphics.moveTo(this.startX, this.startY + y * this.tileWidth);
            this.graphics.lineTo(this.startX + this.boardWidth, this.startY + y * this.tileWidth);
            this.graphics.stroke();
        }
        this.pieceMap = [];
        for (var x = 0; x < this.colsSum; x++) {
            this.pieceMap[x] = [];
            for (var y = 0; y < this.rowsSum; y++) {
                this.pieceMap[x][y] = new ReversiPiece_1.ReversiPiece(x, y, ReversiConstants_1.NONE);
            }
        }
        this.placeBlack(cc.v2(Math.floor(this.colsSum / 2) - 1, Math.floor(this.rowsSum / 2) - 1));
        this.placeBlack(cc.v2(Math.floor(this.colsSum / 2), Math.floor(this.rowsSum / 2)));
        this.placeWhite(cc.v2(cc.v2(Math.floor(this.colsSum / 2) - 1, Math.floor(this.rowsSum / 2))));
        this.placeWhite(cc.v2(cc.v2(Math.floor(this.colsSum / 2), Math.floor(this.rowsSum / 2) - 1)));
    };
    ReversiBoard.prototype.refresh = function () {
        this.graphics2.clear();
        for (var x = 0; x < this.colsSum; x++) {
            for (var y = 0; y < this.rowsSum; y++) {
                if (this.pieceMap[x][y].color === ReversiConstants_1.BLACK) {
                    this.graphics2.strokeColor = cc.Color.BLACK;
                    this.graphics2.fillColor = cc.Color.BLACK;
                    this.graphics2.circle(this.startX + x * this.tileWidth + this.tileWidth / 2, this.startY + y * this.tileWidth + this.tileWidth / 2, this.tileWidth * 0.45);
                    this.graphics2.fill();
                }
                else if (this.pieceMap[x][y].color === ReversiConstants_1.WHITE) {
                    this.graphics2.strokeColor = cc.Color.WHITE;
                    this.graphics2.fillColor = cc.Color.WHITE;
                    this.graphics2.circle(this.startX + x * this.tileWidth + this.tileWidth / 2, this.startY + y * this.tileWidth + this.tileWidth / 2, this.tileWidth * 0.45);
                    this.graphics2.fill();
                }
            }
        }
    };
    ReversiBoard.prototype.placeBlack = function (coor) {
        this.pieceMap[coor.x][coor.y] = new ReversiPiece_1.ReversiPiece(coor.x, coor.y, ReversiConstants_1.BLACK);
        this.lastPiece = this.pieceMap[coor.x][coor.y];
        this.refresh();
    };
    ReversiBoard.prototype.placeWhite = function (coor) {
        this.pieceMap[coor.x][coor.y] = new ReversiPiece_1.ReversiPiece(coor.x, coor.y, ReversiConstants_1.WHITE);
        this.lastPiece = this.pieceMap[coor.x][coor.y];
        this.refresh();
    };
    ReversiBoard.prototype.getPieceByCoor = function (coor) {
        return this.pieceMap[coor.x][coor.y];
    };
    ReversiBoard.prototype.onTouched = function (event) {
        var localPos = this.node.convertToNodeSpaceAR(event.getLocation());
        if (localPos.x < this.startX || localPos.y < this.startY
            || localPos.x > this.startX + this.boardWidth
            || localPos.y > this.startY + this.boardHeight) {
            return;
        }
        var coor = this.getCoorByPos(localPos);
        this.reversiScene.onBoardTouched(coor);
    };
    ReversiBoard.prototype.getCoorByPos = function (pos) {
        var touchCol = Math.round((pos.x - this.startX - this.tileWidth / 2) / this.tileWidth);
        var touchRow = Math.round((pos.y - this.startY - this.tileWidth / 2) / this.tileWidth);
        return cc.v2(touchCol, touchRow);
    };
    ReversiBoard.prototype.nearPiece = function (piece, dir) {
        switch (dir) {
            case 1: //left
                if (piece.x !== 0) {
                    return this.pieceMap[piece.x - 1][piece.y];
                }
                break;
            case 2: //left up
                if (piece.x !== 0 && piece.y !== this.rowsSum - 1) {
                    return this.pieceMap[piece.x - 1][piece.y + 1];
                }
                break;
            case 3: //up
                if (piece.y !== this.rowsSum - 1) {
                    return this.pieceMap[piece.x][piece.y + 1];
                }
                break;
            case 4: //right up
                if (piece.x !== this.colsSum - 1 && piece.y !== this.rowsSum - 1) {
                    return this.pieceMap[piece.x + 1][piece.y + 1];
                }
                break;
            case 5: //right
                if (piece.x !== this.colsSum - 1) {
                    return this.pieceMap[piece.x + 1][piece.y];
                }
                break;
            case 6: //right down
                if (piece.x !== this.colsSum - 1 && piece.y !== 0) {
                    return this.pieceMap[piece.x + 1][piece.y - 1];
                }
                break;
            case 7: //down
                if (piece.y !== 0) {
                    return this.pieceMap[piece.x][piece.y - 1];
                }
                break;
            case 8: //left down
                if (piece.x !== 0 && piece.y !== 0) {
                    return this.pieceMap[piece.x - 1][piece.y - 1];
                }
                break;
            default:
                break;
        }
        return null;
    };
    ReversiBoard.prototype.judgePass = function (stand, piece, dir) {
        var tempPiece = piece;
        tempPiece = this.nearPiece(piece, dir);
        if (tempPiece === null) {
            return false;
        }
        while (tempPiece.color === -stand) {
            tempPiece = this.nearPiece(tempPiece, dir);
            if (tempPiece === null) {
                return false;
            }
            if (tempPiece.color === stand) {
                return true;
            }
        }
        return false;
    };
    ReversiBoard.prototype.changePass = function (piece, dir) {
        var tempPiece = this.nearPiece(piece, dir);
        while (tempPiece.color === -this.reversiScene.state) {
            tempPiece.color = piece.color;
            tempPiece = this.nearPiece(tempPiece, dir);
        }
        this.refresh();
    };
    ReversiBoard.prototype.canPlace = function (color, coor) {
        for (var dir = 1; dir <= 8; dir++) {
            if (this.judgePass(color, this.getPieceByCoor(coor), dir)) {
                return true;
            }
            if (dir === 8) {
                return false;
            }
        }
    };
    ReversiBoard.prototype.judgeMoveable = function (stand) {
        var tryPiece = null;
        for (var x = 0; x < this.colsSum; x++) {
            for (var y = 0; y < this.rowsSum; y++) {
                tryPiece = this.pieceMap[x][y];
                if (tryPiece.color === ReversiConstants_1.NONE) {
                    for (var dir = 1; dir <= 8; dir++) {
                        if (this.judgePass(stand, tryPiece, dir)) {
                            return true;
                        }
                    }
                }
            }
        }
        return false;
    };
    ReversiBoard.prototype.judgeWin = function () {
        var selfMoveAble = this.judgeMoveable(this.lastPiece.color);
        var oppoMoveAble = this.judgeMoveable(-this.lastPiece.color);
        if (!selfMoveAble && !oppoMoveAble) {
            return true;
        }
        else {
            return false;
        }
    };
    ReversiBoard.prototype.getPieceCount = function () {
        var blackPieceSum = 0;
        var whitePieceSum = 0;
        for (var x = 0; x < this.pieceMap.length; x++) {
            for (var y = 0; y < this.pieceMap[x].length; y++) {
                if (this.pieceMap[x][y].color === ReversiConstants_1.BLACK) {
                    blackPieceSum++;
                }
                else if (this.pieceMap[x][y].color === ReversiConstants_1.WHITE) {
                    whitePieceSum++;
                }
            }
        }
        return { blackPieceSum: blackPieceSum, whitePieceSum: whitePieceSum };
    };
    ReversiBoard.prototype.addListeners = function () {
        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouched, this);
    };
    ReversiBoard.prototype.removeListeners = function () {
    };
    __decorate([
        property(cc.Integer)
    ], ReversiBoard.prototype, "colsSum", void 0);
    __decorate([
        property(cc.Integer)
    ], ReversiBoard.prototype, "rowsSum", void 0);
    __decorate([
        property(cc.Graphics)
    ], ReversiBoard.prototype, "graphics", void 0);
    __decorate([
        property(cc.Graphics)
    ], ReversiBoard.prototype, "graphics2", void 0);
    ReversiBoard = __decorate([
        ccclass
    ], ReversiBoard);
    return ReversiBoard;
}(cc.Component));
exports.ReversiBoard = ReversiBoard;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc3JjXFxyZXZlcnNpXFxSZXZlcnNpQm9hcmQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwrQ0FBOEM7QUFFOUMsdURBQXdEO0FBRWxELElBQUEsS0FBd0IsRUFBRSxDQUFDLFVBQVUsRUFBbkMsT0FBTyxhQUFBLEVBQUUsUUFBUSxjQUFrQixDQUFDO0FBRzVDO0lBQWtDLGdDQUFZO0lBQTlDO1FBQUEscUVBNFBDO1FBMVBXLGFBQU8sR0FBVyxDQUFDLENBQUM7UUFFcEIsYUFBTyxHQUFXLENBQUMsQ0FBQztRQUVwQixjQUFRLEdBQWdCLElBQUksQ0FBQyxDQUFDLFFBQVE7UUFFdEMsZUFBUyxHQUFnQixJQUFJLENBQUMsQ0FBQyxRQUFRO1FBRXZDLGVBQVMsR0FBVyxDQUFDLENBQUMsQ0FBQyxVQUFVO1FBQ2pDLFlBQU0sR0FBVyxDQUFDLENBQUMsQ0FBQyxRQUFRO1FBQzVCLFlBQU0sR0FBVyxDQUFDLENBQUM7UUFDbkIsZ0JBQVUsR0FBVyxDQUFDLENBQUMsQ0FBQyxTQUFTO1FBQ2pDLGlCQUFXLEdBQVcsQ0FBQyxDQUFDO1FBRXpCLGVBQVMsR0FBaUIsSUFBSSxDQUFDO1FBRTlCLGtCQUFZLEdBQWlCLElBQUksQ0FBQzs7SUEwTzlDLENBQUM7SUF4T1UsMkJBQUksR0FBWCxVQUFZLFlBQTBCO1FBQ2xDLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBRWpDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3RELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxT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QyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQzlDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssd0JBQUssRUFBRTtvQkFDckMsYUFBYSxFQUFFLENBQUM7aUJBQ25CO3FCQUFNLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssd0JBQUssRUFBRTtvQkFDNUMsYUFBYSxFQUFFLENBQUM7aUJBQ25CO2FBQ0o7U0FDSjtRQUNELE9BQU8sRUFBRSxhQUFhLGVBQUEsRUFBRSxhQUFhLGVBQUEsRUFBRSxDQUFDO0lBQzVDLENBQUM7SUFFTyxtQ0FBWSxHQUFwQjtRQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFFTyxzQ0FBZSxHQUF2QjtJQUVBLENBQUM7SUF6UEQ7UUFEQyxRQUFRLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQztpREFDTztJQUU1QjtRQURDLFFBQVEsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDO2lEQUNPO0lBRTVCO1FBREMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUM7a0RBQ2U7SUFFckM7UUFEQyxRQUFRLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQzttREFDZ0I7SUFSN0IsWUFBWTtRQUR4QixPQUFPO09BQ0ssWUFBWSxDQTRQeEI7SUFBRCxtQkFBQztDQTVQRCxBQTRQQyxDQTVQaUMsRUFBRSxDQUFDLFNBQVMsR0E0UDdDO0FBNVBZLG9DQUFZIiwiZmlsZSI6IiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmV2ZXJzaVBpZWNlIH0gZnJvbSBcIi4vUmV2ZXJzaVBpZWNlXCI7XG5pbXBvcnQgeyBSZXZlcnNpU2NlbmUgfSBmcm9tIFwiLi9SZXZlcnNpU2NlbmVcIjtcbmltcG9ydCB7IE5PTkUsIEJMQUNLLCBXSElURSB9IGZyb20gXCIuL1JldmVyc2lDb25zdGFudHNcIjtcblxuY29uc3QgeyBjY2NsYXNzLCBwcm9wZXJ0eSB9ID0gY2MuX2RlY29yYXRvcjtcblxuQGNjY2xhc3NcbmV4cG9ydCBjbGFzcyBSZXZlcnNpQm9hcmQgZXh0ZW5kcyBjYy5Db21wb25lbnQge1xuICAgIEBwcm9wZXJ0eShjYy5JbnRlZ2VyKVxuICAgIHByaXZhdGUgY29sc1N1bTogbnVtYmVyID0gODtcbiAgICBAcHJvcGVydHkoY2MuSW50ZWdlcilcbiAgICBwcml2YXRlIHJvd3NTdW06IG51bWJlciA9IDg7XG4gICAgQHByb3BlcnR5KGNjLkdyYXBoaWNzKVxuICAgIHByaXZhdGUgZ3JhcGhpY3M6IGNjLkdyYXBoaWNzID0gbnVsbDsgLy8g55So5p2l55S75qOL55uYXG4gICAgQHByb3BlcnR5KGNjLkdyYXBoaWNzKVxuICAgIHByaXZhdGUgZ3JhcGhpY3MyOiBjYy5HcmFwaGljcyA9IG51bGw7IC8vIOeUqOadpeeUu+aji+WtkFxuXG4gICAgcHJpdmF0ZSB0aWxlV2lkdGg6IG51bWJlciA9IDA7IC8vIOS4gOS4quaWueWdl+eahOWuveW6plxuICAgIHByaXZhdGUgc3RhcnRYOiBudW1iZXIgPSAwOyAvLyDmo4vnm5jlt6bkuIvop5JcbiAgICBwcml2YXRlIHN0YXJ0WTogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIGJvYXJkV2lkdGg6IG51bWJlciA9IDA7IC8vIOaji+ebmOiKgueCueWuvemrmFxuICAgIHByaXZhdGUgYm9hcmRIZWlnaHQ6IG51bWJlciA9IDA7XG4gICAgcHVibGljIHBpZWNlTWFwOiBBcnJheTxBcnJheTxSZXZlcnNpUGllY2U+PjtcbiAgICBwdWJsaWMgbGFzdFBpZWNlOiBSZXZlcnNpUGllY2UgPSBudWxsO1xuXG4gICAgcHJpdmF0ZSByZXZlcnNpU2NlbmU6IFJldmVyc2lTY2VuZSA9IG51bGw7XG5cbiAgICBwdWJsaWMgaW5pdChyZXZlcnNpU2NlbmU6IFJldmVyc2lTY2VuZSkge1xuICAgICAgICB0aGlzLnJldmVyc2lTY2VuZSA9IHJldmVyc2lTY2VuZTtcblxuICAgICAgICB0aGlzLnRpbGVXaWR0aCA9IHRoaXMubm9kZS53aWR0aCAvICh0aGlzLmNvbHNTdW0gKyAxKTtcbiAgICAgICAgdGhpcy5zdGFydFggPSB0aGlzLnRpbGVXaWR0aCAvIDI7XG4gICAgICAgIHRoaXMuc3RhcnRZID0gdGhpcy50aWxlV2lkdGggLyAyO1xuICAgICAgICB0aGlzLmJvYXJkV2lkdGggPSB0aGlzLnRpbGVXaWR0aCAqIHRoaXMuY29sc1N1bTtcbiAgICAgICAgdGhpcy5ib2FyZEhlaWdodCA9IHRoaXMudGlsZVdpZHRoICogdGhpcy5yb3dzU3VtO1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG5cbiAgICAgICAgdGhpcy5hZGRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuZ3JhcGhpY3MuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5ncmFwaGljczIuY2xlYXIoKTtcbiAgICAgICAgLy8g55S75qOL55uYXG4gICAgICAgIHRoaXMuZ3JhcGhpY3Muc3Ryb2tlQ29sb3IgPSBjYy5Db2xvci5CTEFDSztcbiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLmNvbHNTdW0gKyAxOyB4KyspIHtcbiAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3MubW92ZVRvKHRoaXMuc3RhcnRYICsgeCAqIHRoaXMudGlsZVdpZHRoLCB0aGlzLnN0YXJ0WSk7XG4gICAgICAgICAgICB0aGlzLmdyYXBoaWNzLmxpbmVUbyh0aGlzLnN0YXJ0WCArIHggKiB0aGlzLnRpbGVXaWR0aCwgdGhpcy5zdGFydFkgKyB0aGlzLmJvYXJkSGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3Muc3Ryb2tlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLnJvd3NTdW0gKyAxOyB5KyspIHtcbiAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3MubW92ZVRvKHRoaXMuc3RhcnRYLCB0aGlzLnN0YXJ0WSArIHkgKiB0aGlzLnRpbGVXaWR0aCk7XG4gICAgICAgICAgICB0aGlzLmdyYXBoaWNzLmxpbmVUbyh0aGlzLnN0YXJ0WCArIHRoaXMuYm9hcmRXaWR0aCwgdGhpcy5zdGFydFkgKyB5ICogdGhpcy50aWxlV2lkdGgpO1xuICAgICAgICAgICAgdGhpcy5ncmFwaGljcy5zdHJva2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucGllY2VNYXAgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLmNvbHNTdW07IHgrKykge1xuICAgICAgICAgICAgdGhpcy5waWVjZU1hcFt4XSA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLnJvd3NTdW07IHkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMucGllY2VNYXBbeF1beV0gPSBuZXcgUmV2ZXJzaVBpZWNlKHgsIHksIE5PTkUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5wbGFjZUJsYWNrKGNjLnYyKE1hdGguZmxvb3IodGhpcy5jb2xzU3VtIC8gMikgLSAxLCBNYXRoLmZsb29yKHRoaXMucm93c1N1bSAvIDIpIC0gMSkpO1xuICAgICAgICB0aGlzLnBsYWNlQmxhY2soY2MudjIoTWF0aC5mbG9vcih0aGlzLmNvbHNTdW0gLyAyKSwgTWF0aC5mbG9vcih0aGlzLnJvd3NTdW0gLyAyKSkpO1xuICAgICAgICB0aGlzLnBsYWNlV2hpdGUoY2MudjIoY2MudjIoTWF0aC5mbG9vcih0aGlzLmNvbHNTdW0gLyAyKSAtIDEsIE1hdGguZmxvb3IodGhpcy5yb3dzU3VtIC8gMikpKSk7XG4gICAgICAgIHRoaXMucGxhY2VXaGl0ZShjYy52MihjYy52MihNYXRoLmZsb29yKHRoaXMuY29sc1N1bSAvIDIpLCBNYXRoLmZsb29yKHRoaXMucm93c1N1bSAvIDIpIC0gMSkpKTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgcmVmcmVzaCgpIHtcbiAgICAgICAgdGhpcy5ncmFwaGljczIuY2xlYXIoKTtcbiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLmNvbHNTdW07IHgrKykge1xuICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLnJvd3NTdW07IHkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBpZWNlTWFwW3hdW3ldLmNvbG9yID09PSBCTEFDSykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyYXBoaWNzMi5zdHJva2VDb2xvciA9IGNjLkNvbG9yLkJMQUNLO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyYXBoaWNzMi5maWxsQ29sb3IgPSBjYy5Db2xvci5CTEFDSztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmFwaGljczIuY2lyY2xlKHRoaXMuc3RhcnRYICsgeCAqIHRoaXMudGlsZVdpZHRoICsgdGhpcy50aWxlV2lkdGggLyAyLCB0aGlzLnN0YXJ0WSArIHkgKiB0aGlzLnRpbGVXaWR0aCArIHRoaXMudGlsZVdpZHRoIC8gMiwgdGhpcy50aWxlV2lkdGggKiAwLjQ1KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmFwaGljczIuZmlsbCgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5waWVjZU1hcFt4XVt5XS5jb2xvciA9PT0gV0hJVEUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmFwaGljczIuc3Ryb2tlQ29sb3IgPSBjYy5Db2xvci5XSElURTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmFwaGljczIuZmlsbENvbG9yID0gY2MuQ29sb3IuV0hJVEU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3MyLmNpcmNsZSh0aGlzLnN0YXJ0WCArIHggKiB0aGlzLnRpbGVXaWR0aCArIHRoaXMudGlsZVdpZHRoIC8gMiwgdGhpcy5zdGFydFkgKyB5ICogdGhpcy50aWxlV2lkdGggKyB0aGlzLnRpbGVXaWR0aCAvIDIsIHRoaXMudGlsZVdpZHRoICogMC40NSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JhcGhpY3MyLmZpbGwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgcGxhY2VCbGFjayhjb29yOiBjYy5WZWMyKSB7XG4gICAgICAgIHRoaXMucGllY2VNYXBbY29vci54XVtjb29yLnldID0gbmV3IFJldmVyc2lQaWVjZShjb29yLngsIGNvb3IueSwgQkxBQ0spO1xuICAgICAgICB0aGlzLmxhc3RQaWVjZSA9IHRoaXMucGllY2VNYXBbY29vci54XVtjb29yLnldO1xuICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcGxhY2VXaGl0ZShjb29yOiBjYy5WZWMyKSB7XG4gICAgICAgIHRoaXMucGllY2VNYXBbY29vci54XVtjb29yLnldID0gbmV3IFJldmVyc2lQaWVjZShjb29yLngsIGNvb3IueSwgV0hJVEUpO1xuICAgICAgICB0aGlzLmxhc3RQaWVjZSA9IHRoaXMucGllY2VNYXBbY29vci54XVtjb29yLnldO1xuICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UGllY2VCeUNvb3IoY29vcjogY2MuVmVjMik6IFJldmVyc2lQaWVjZSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBpZWNlTWFwW2Nvb3IueF1bY29vci55XTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uVG91Y2hlZChldmVudDogY2MuRXZlbnQuRXZlbnRUb3VjaCkge1xuICAgICAgICBsZXQgbG9jYWxQb3MgPSB0aGlzLm5vZGUuY29udmVydFRvTm9kZVNwYWNlQVIoZXZlbnQuZ2V0TG9jYXRpb24oKSk7XG4gICAgICAgIGlmIChsb2NhbFBvcy54IDwgdGhpcy5zdGFydFggfHwgbG9jYWxQb3MueSA8IHRoaXMuc3RhcnRZXG4gICAgICAgICAgICB8fCBsb2NhbFBvcy54ID4gdGhpcy5zdGFydFggKyB0aGlzLmJvYXJkV2lkdGhcbiAgICAgICAgICAgIHx8IGxvY2FsUG9zLnkgPiB0aGlzLnN0YXJ0WSArIHRoaXMuYm9hcmRIZWlnaHQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgY29vciA9IHRoaXMuZ2V0Q29vckJ5UG9zKGxvY2FsUG9zKTtcbiAgICAgICAgdGhpcy5yZXZlcnNpU2NlbmUub25Cb2FyZFRvdWNoZWQoY29vcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRDb29yQnlQb3MocG9zOiBjYy5WZWMyKTogY2MuVmVjMiB7XG4gICAgICAgIGxldCB0b3VjaENvbCA9IE1hdGgucm91bmQoKHBvcy54IC0gdGhpcy5zdGFydFggLSB0aGlzLnRpbGVXaWR0aCAvIDIpIC8gdGhpcy50aWxlV2lkdGgpO1xuICAgICAgICBsZXQgdG91Y2hSb3cgPSBNYXRoLnJvdW5kKChwb3MueSAtIHRoaXMuc3RhcnRZIC0gdGhpcy50aWxlV2lkdGggLyAyKSAvIHRoaXMudGlsZVdpZHRoKTtcbiAgICAgICAgcmV0dXJuIGNjLnYyKHRvdWNoQ29sLCB0b3VjaFJvdyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBuZWFyUGllY2UocGllY2U6IFJldmVyc2lQaWVjZSwgZGlyOiBudW1iZXIpOiBSZXZlcnNpUGllY2Uge1xuICAgICAgICBzd2l0Y2ggKGRpcikge1xuICAgICAgICAgICAgY2FzZSAxOi8vbGVmdFxuICAgICAgICAgICAgICAgIGlmIChwaWVjZS54ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBpZWNlTWFwW3BpZWNlLnggLSAxXVtwaWVjZS55XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6Ly9sZWZ0IHVwXG4gICAgICAgICAgICAgICAgaWYgKHBpZWNlLnggIT09IDAgJiYgcGllY2UueSAhPT0gdGhpcy5yb3dzU3VtIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5waWVjZU1hcFtwaWVjZS54IC0gMV1bcGllY2UueSArIDFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzovL3VwXG4gICAgICAgICAgICAgICAgaWYgKHBpZWNlLnkgIT09IHRoaXMucm93c1N1bSAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGllY2VNYXBbcGllY2UueF1bcGllY2UueSArIDFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNDovL3JpZ2h0IHVwXG4gICAgICAgICAgICAgICAgaWYgKHBpZWNlLnggIT09IHRoaXMuY29sc1N1bSAtIDEgJiYgcGllY2UueSAhPT0gdGhpcy5yb3dzU3VtIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5waWVjZU1hcFtwaWVjZS54ICsgMV1bcGllY2UueSArIDFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNTovL3JpZ2h0XG4gICAgICAgICAgICAgICAgaWYgKHBpZWNlLnggIT09IHRoaXMuY29sc1N1bSAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGllY2VNYXBbcGllY2UueCArIDFdW3BpZWNlLnldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNjovL3JpZ2h0IGRvd25cbiAgICAgICAgICAgICAgICBpZiAocGllY2UueCAhPT0gdGhpcy5jb2xzU3VtIC0gMSAmJiBwaWVjZS55ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBpZWNlTWFwW3BpZWNlLnggKyAxXVtwaWVjZS55IC0gMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA3Oi8vZG93blxuICAgICAgICAgICAgICAgIGlmIChwaWVjZS55ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBpZWNlTWFwW3BpZWNlLnhdW3BpZWNlLnkgLSAxXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDg6Ly9sZWZ0IGRvd25cbiAgICAgICAgICAgICAgICBpZiAocGllY2UueCAhPT0gMCAmJiBwaWVjZS55ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBpZWNlTWFwW3BpZWNlLnggLSAxXVtwaWVjZS55IC0gMV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGp1ZGdlUGFzcyhzdGFuZDogbnVtYmVyLCBwaWVjZTogUmV2ZXJzaVBpZWNlLCBkaXI6IG51bWJlcikge1xuICAgICAgICBsZXQgdGVtcFBpZWNlID0gcGllY2U7XG4gICAgICAgIHRlbXBQaWVjZSA9IHRoaXMubmVhclBpZWNlKHBpZWNlLCBkaXIpO1xuICAgICAgICBpZiAodGVtcFBpZWNlID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKHRlbXBQaWVjZS5jb2xvciA9PT0gLXN0YW5kKSB7XG4gICAgICAgICAgICB0ZW1wUGllY2UgPSB0aGlzLm5lYXJQaWVjZSh0ZW1wUGllY2UsIGRpcik7XG4gICAgICAgICAgICBpZiAodGVtcFBpZWNlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRlbXBQaWVjZS5jb2xvciA9PT0gc3RhbmQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY2hhbmdlUGFzcyhwaWVjZTogUmV2ZXJzaVBpZWNlLCBkaXI6IG51bWJlcikge1xuICAgICAgICBsZXQgdGVtcFBpZWNlID0gdGhpcy5uZWFyUGllY2UocGllY2UsIGRpcik7XG4gICAgICAgIHdoaWxlICh0ZW1wUGllY2UuY29sb3IgPT09IC10aGlzLnJldmVyc2lTY2VuZS5zdGF0ZSkge1xuICAgICAgICAgICAgdGVtcFBpZWNlLmNvbG9yID0gcGllY2UuY29sb3I7XG4gICAgICAgICAgICB0ZW1wUGllY2UgPSB0aGlzLm5lYXJQaWVjZSh0ZW1wUGllY2UsIGRpcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgfVxuXG4gICAgY2FuUGxhY2UoY29sb3I6bnVtYmVyLGNvb3I6Y2MuVmVjMik6Ym9vbGVhbiB7XG4gICAgICAgIGZvciAobGV0IGRpciA9IDE7IGRpciA8PSA4OyBkaXIrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMuanVkZ2VQYXNzKGNvbG9yLCB0aGlzLmdldFBpZWNlQnlDb29yKGNvb3IpLCBkaXIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGlyID09PSA4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAganVkZ2VNb3ZlYWJsZShzdGFuZCkgey8v5Yik5patc3RhbmTmmK/lkKbmnInlj6/okL3lrZDnmoTlnLDmlrlcbiAgICAgICAgbGV0IHRyeVBpZWNlID0gbnVsbDtcbiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLmNvbHNTdW07IHgrKykge1xuICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLnJvd3NTdW07IHkrKykge1xuICAgICAgICAgICAgICAgIHRyeVBpZWNlID0gdGhpcy5waWVjZU1hcFt4XVt5XTtcbiAgICAgICAgICAgICAgICBpZiAodHJ5UGllY2UuY29sb3IgPT09IE5PTkUpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgZGlyID0gMTsgZGlyIDw9IDg7IGRpcisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5qdWRnZVBhc3Moc3RhbmQsIHRyeVBpZWNlLCBkaXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGp1ZGdlV2luKCkge1xuICAgICAgICBsZXQgc2VsZk1vdmVBYmxlID0gdGhpcy5qdWRnZU1vdmVhYmxlKHRoaXMubGFzdFBpZWNlLmNvbG9yKTtcbiAgICAgICAgbGV0IG9wcG9Nb3ZlQWJsZSA9IHRoaXMuanVkZ2VNb3ZlYWJsZSgtdGhpcy5sYXN0UGllY2UuY29sb3IpO1xuICAgICAgICBpZiAoIXNlbGZNb3ZlQWJsZSAmJiAhb3Bwb01vdmVBYmxlKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldFBpZWNlQ291bnQoKSB7XG4gICAgICAgIGxldCBibGFja1BpZWNlU3VtID0gMDtcbiAgICAgICAgbGV0IHdoaXRlUGllY2VTdW0gPSAwO1xuICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHRoaXMucGllY2VNYXAubGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdGhpcy5waWVjZU1hcFt4XS5sZW5ndGg7IHkrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBpZWNlTWFwW3hdW3ldLmNvbG9yID09PSBCTEFDSykge1xuICAgICAgICAgICAgICAgICAgICBibGFja1BpZWNlU3VtKys7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBpZWNlTWFwW3hdW3ldLmNvbG9yID09PSBXSElURSkge1xuICAgICAgICAgICAgICAgICAgICB3aGl0ZVBpZWNlU3VtKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGJsYWNrUGllY2VTdW0sIHdoaXRlUGllY2VTdW0gfTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGFkZExpc3RlbmVycygpIHtcbiAgICAgICAgdGhpcy5ub2RlLm9uKGNjLk5vZGUuRXZlbnRUeXBlLlRPVUNIX0VORCwgdGhpcy5vblRvdWNoZWQsIHRoaXMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcmVtb3ZlTGlzdGVuZXJzKCkge1xuXG4gICAgfVxufVxuIl19